## 名字与地址转换

# 域名系统（DNS）

用于主机名字（unpbook.com）与IP地址之间的映射

1. 资源记录

   DNS中的条目称为资源记录（resource record, RR），RR类型有若干个：

   * A	A记录把主机名映射成32位IPv4地址
   * AAAA    四A记录把主机名映射成128位IPv6地址
   * PTR    指针记录（pointer record）把IP地址映射成主机名
   * *MX    MX记录把一个主机指定作为给定主机的邮件交换器*
   * CNAME    代表canonical name（规范名字）为常用的服务指派CNAME记录（比如ftp和www）

2. 解析器和名字服务器(name server)

   每个组织机构往往运行一个或多个名字服务器，即BIND(Berkeley Internet Name Domain)。程序调用名为解析器(resolver)的函数库中的函数接触DNS服务器(gethostbyname gethostbyaddr)

3. gethostbyname函数

   用于查找主机名，如果调用成功，返回一个指向hostent结构的指针

   ```c
   #include <netdb.h>
   
   struct hostent *gethostbyname(const char *hostname);
   
   struct hostent{
       char *h_name; // official name of host
       char **h_aliases; // pointer tot array of pointers to alias names
       int h_addrtype; // host address type(AF_INET)
       int h_length; // length of address: 4
   	char **h_addr_list; // ptr to array of ptrs with IPv4 addrs        
   };
   ```

   * 查询返回的一定是h_name(正式名称)
   * h_aliases是该地址的一串别名
   * h_addr_list是该域名的ip地址簇
   * **gethostbyname发生错误时不设置errno变量，而是将全局整数变量h_errno设置为下面之一：**
     * HOST_NOT_FOUND
     * TRY_AGAIN
     * NO_RECOVERY
     * NO_DATA(NO_ADDRESS)  // 名字有效但无A记录（IPv4记录）
   * 